Requisito 2 - PrBD

--Requerimiento 2
CREATE OR REPLACE TRIGGER CLIENTES_JORNADA
BEFORE INSERT OR UPDATE OR DELETE ON CLIENTES 
FOR EACH ROW
DECLARE 
    V_DIA NUMBER; 
    V_HORA NUMBER; 
BEGIN
    V_DIA := TO_NUMBER(TO_CHAR(SYSDATE, 'D'));  -- Día de la semana (1=Domingo, 2=Lunes, ..., 7=Sábado)
    V_HORA := TO_NUMBER(TO_CHAR(SYSDATE, 'HH24'));  -- Hora en formato 24 horas
    
    -- Verificar si el día es entre lunes y viernes (2 a 6) y la hora entre 08:00 y 18:00
    IF (V_DIA BETWEEN 2 AND 6) AND (V_HORA BETWEEN 8 AND 18) THEN
        NULL;  -- Permitir la operación (no se hace nada)
    ELSE
        -- Si la operación se realiza fuera del horario laboral
        IF INSERTING THEN
            RAISE_APPLICATION_ERROR(-20501, 'SE DEBE INSERTAR VALORES SOLO EN LA JORNADA DE TRABAJO');
        ELSIF UPDATING THEN
            RAISE_APPLICATION_ERROR(-20503, 'SE DEBE MODIFICAR VALORES SOLO EN LA JORNADA DE TRABAJO');
        ELSIF DELETING THEN
            RAISE_APPLICATION_ERROR(-20502, 'SE DEBE ELIMINAR SOLO EN LA JORNADA DE TRABAJO');
        END IF;
    END IF;
END;
/


--INSERTAR UN CLIENTE
INSERT INTO CLIENTES ( CLIENTE_ID, CEDULA_RUC, NOMBRE_CIA, NOMBRE_CONTACTO, DIRECCION_CLI, FAX, EMAIL, CELULAR, FIJO, ID_COMUNA)
VALUES (11, '21345678', 'SUPERMERCADO TODOCARO', 'LUIS SEPULVEDA', 'VICUÑA MACKENNA', NULL, NULL, NULL, NULL, 2);

--ELIMINAR A UN CLIENTE
DELETE FROM CLIENTES WHERE CLIENTE_ID = 10;

--ACTUALIZAR INFORMACION DE UN CLIENTE
UPDATE CLIENTES SET CELULAR = '9555889' WHERE CLIENTE_ID = 9;

